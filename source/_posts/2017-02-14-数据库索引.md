---
title: 数据库索引
date: 2017-02-14 11:38:53
categories:
- 数据库
---

**索引**是对数据库表中一个或多个列的值进行排序的数据结构。建立索引的目的是加快表中记录的查找或排序。

如果没有索引，必须遍历整个表，直到找到目标记录为止；有了索引之后即可在索引中查找。由于索引是经过某种算法优化过的，因而查找次数要少的多。

# 类型
## 普通索引
普通索引是最基本的数据库索引，没有任何限制。

## 唯一索引
唯一索引是不允许其中任何两行具有相同索引值的索引。如果是组合索引，则列值的组合必须唯一。

## 主键索引
数据库表经常有一列或多列组合，其值唯一标识表中的每一行。该列称为表的主键。
在数据库关系图中为表定义主键将自动创建主键索引，主键索引是唯一索引的特定类型。

## 聚集索引
**聚集索引**：表数据按照索引的顺序来存储的。对于聚集索引，叶子结点即存储了真实的数据行，不再有另外单独的数据页。

**非聚集索引**：表数据存储顺序与索引顺序无关。对于非聚集索引，叶结点包含索引字段值及指向数据页数据行的逻辑指针，该层紧邻数据页，其行数量与数据表行数据量一致。

# 索引实现
B树和B+树。

# 不同存储引擎的索引
## MyISAM
**MyISAM** 存储引擎的索引方式是**非聚集索引**，**索引文件和数据文件是分离的**，索引文件仅保存数据记录的地址。

在MyISAM中，主索引和辅助索引（Secondary key）在结构上没有任何区别，只是主索引要求key是唯一的，而辅助索引的key可以重复。

## InnoDB
 **InnoDB** 存储引擎的索引方式是**聚集索引**，叶节点data域保存了完整的数据记录，InnoDB表数据文件本身就是主索引。因为InnoDB的数据文件本身要按主键聚集，所以InnoDB要求表必须有主键（MyISAM可以没有）。

与MyISAM索引的不同是InnoDB的辅助索引data域存储相应记录主键的值而不是地址。

> 知道了InnoDB的索引实现后，就很容易明白为什么不建议使用过长的字段作为主键，因为所有辅助索引都引用主索引，过长的主索引会令辅助索引变得过大。

> 用非单调的字段作为主键在InnoDB中不是个好主意，因为InnoDB数据文件本身是一颗B+Tree，非单调的主键会造成在插入新记录时数据文件为了维持B+Tree的特性而频繁的分裂调整，十分低效，而使用自增字段作为主键则是一个很好的选择。

# 优缺点
## 优点
**创建索引可以大大提高系统的性能。**
1. 通过创建唯一性索引，可以保证数据库表中每一行数据的**唯一性**。
2. 可以大大加快数据的**检索速度**，这也是创建索引的最主要的原因。
3. 可以**加速表间的连接**，特别是在实现数据的参考完整性方面特别有意义。
4. 在使用**分组/排序**子句进行数据检索时，同样可以显著减少查询中分组和排序的时间。
5. 通过使用索引，可以在查询的过程中，使用**优化隐藏器**，提高系统的性能。

## 缺点
1. 增加了数据库的存储空间。
2. 在插入和修改数据时要花费较多的时间（因为索引也要变动）。

# 使用场景
## 应该创建索引的场景
1. 经常用于表连接的列上。
2. 经常需要进行范围搜索的列上。
3. 经常需要排序的列上。
4. 经常使用WHERE子句中的列上。

## 不应该创建索引的场景
1. 查询中很少使用的列不应该创建索引。
2. 对于只有很少数据值的列不应该创建索引。
3. 对于定义为text、image和bit数据类型的列不应该创建索引。
4. 当修改性能远远大于检索性能时，不应该创建索引。

# 索引设计原则
1. **搜索的索引列**
最适合索引的列是出现在 WHERE 子句中的列，或者连接句中的列。
2. **使用唯一索引**
考虑某列中值的分布，索引的列的基数越大（重复值越少），索引的效果越好。
3. **使用短索引**
如果对字符串进行索引，应该指定一个前缀长度。
4. **利用最左前缀**
在创建一个n列的索引时，实际是创建了 MySQL 可利用的n个索引。多列索引可起几个索引的作用，因为可利用索引中最左边的列集来匹配行。

# 索引优化策略
MySQL的优化主要分为结构优化（Scheme optimization）和查询优化（Query optimization）
具体各种优化情况，可以参见下面的链接。


* * *
感谢：[MySQL索引背后的数据结构与算法原理](http://blog.codinglabs.org/articles/theory-of-mysql-index.html)